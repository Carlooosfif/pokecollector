# ğŸƒ PokÃ©Collector Backend

Sistema de coleccionismo de cartas PokÃ©mon desarrollado con Node.js, TypeScript, SQLite y Prisma.

## ğŸš€ InstalaciÃ³n y ConfiguraciÃ³n

### Prerrequisitos
- Node.js (versiÃ³n 18 o superior)
- npm o yarn
- Visual Studio Code (recomendado)

### 1. Clonar y configurar el proyecto

```bash
# Instalar dependencias
npm install

# Copiar archivo de entorno
cp .env.example .env
```

### 2. Configurar variables de entorno

Edita el archivo `.env` con tus configuraciones:

```env
# Database
DATABASE_URL="file:./dev.db"

# JWT
JWT_SECRET="tu_clave_secreta_muy_segura_aqui_cambiala"
JWT_EXPIRES_IN="7d"

# Server
PORT=3001
NODE_ENV="development"

# CORS
CORS_ORIGIN="http://localhost:3000"
```

### 3. Configurar la base de datos

```bash
# Generar cliente de Prisma
npm run db:generate

# Crear base de datos y tablas
npm run db:push

# Poblar con datos iniciales
npm run db:seed
```

### 4. Ejecutar el servidor

```bash
# Modo desarrollo (con recarga automÃ¡tica)
npm run dev

# Modo producciÃ³n
npm run build
npm start
```

El servidor estarÃ¡ disponible en: `http://localhost:3001`

## ğŸ“¡ API Endpoints

### ğŸ” AutenticaciÃ³n

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| POST | `/api/auth/register` | Registrar usuario | No |
| POST | `/api/auth/login` | Iniciar sesiÃ³n | No |
| GET | `/api/auth/validate` | Validar token | No |

### ğŸ‘¥ Usuarios

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| GET | `/api/users/profile` | Obtener perfil | SÃ­ |
| PUT | `/api/users/profile` | Actualizar perfil | SÃ­ |
| GET | `/api/users/stats` | EstadÃ­sticas del usuario | SÃ­ |
| GET | `/api/users/ranking` | Ranking de usuarios | No |
| GET | `/api/users` | Listar usuarios | Admin |

### ğŸ“š Ãlbumes

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| GET | `/api/albums` | Listar Ã¡lbumes | No |
| GET | `/api/albums/:id` | Obtener Ã¡lbum | No |
| POST | `/api/albums` | Crear Ã¡lbum | Admin |
| PUT | `/api/albums/:id` | Actualizar Ã¡lbum | Admin |
| DELETE | `/api/albums/:id` | Eliminar Ã¡lbum | Admin |

### ğŸƒ Cartas

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| GET | `/api/cards` | Listar cartas | No |
| GET | `/api/cards/:id` | Obtener carta | No |
| GET | `/api/cards/album/:albumId` | Cartas por Ã¡lbum | No |
| POST | `/api/cards` | Crear carta | Admin |
| PUT | `/api/cards/:id` | Actualizar carta | Admin |
| DELETE | `/api/cards/:id` | Eliminar carta | Admin |

### ğŸ’ ColecciÃ³n de Usuario

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| GET | `/api/cards/collection/my` | Mi colecciÃ³n | SÃ­ |
| POST | `/api/cards/collection` | Agregar carta | SÃ­ |
| DELETE | `/api/cards/collection/:cardId` | Quitar carta | SÃ­ |
| PUT | `/api/cards/collection/:userCardId/quantity` | Actualizar cantidad | SÃ­ |

## ğŸ§ª Datos de Prueba

DespuÃ©s del seed, tendrÃ¡s estos usuarios disponibles:

```
Admin: admin@pokecollector.com / admin123
Usuario 1: ash@pokecollector.com / user123
Usuario 2: misty@pokecollector.com / user123
Usuario 3: brock@pokecollector.com / user123
```

## ğŸ”¨ Comandos Ãštiles

```bash
# Desarrollo
npm run dev                 # Ejecutar en modo desarrollo
npm run build              # Compilar TypeScript
npm start                  # Ejecutar versiÃ³n compilada

# Base de datos
npm run db:generate        # Generar cliente Prisma
npm run db:push           # Sincronizar esquema con BD
npm run db:migrate        # Crear migraciÃ³n
npm run db:seed           # Poblar con datos iniciales
npm run db:studio         # Abrir Prisma Studio

# Utilidades
npm run test              # Ejecutar tests (cuando estÃ©n configurados)
```

## ğŸ—ï¸ Arquitectura del Proyecto

### Principios SOLID Aplicados:

1. **Single Responsibility Principle (SRP)**:
   - Cada clase tiene una Ãºnica responsabilidad
   - Controladores solo manejan HTTP
   - Servicios solo contienen lÃ³gica de negocio
   - Repositorios solo manejan acceso a datos

2. **Dependency Inversion Principle (DIP)**:
   - Uso de interfaces para abstraer dependencias
   - InyecciÃ³n de dependencias a travÃ©s del Factory Pattern

### Patrones de DiseÃ±o:

1. **Repository Pattern**: Abstrae el acceso a datos
2. **Factory Method Pattern**: Crea instancias de repositorios
3. **Singleton Pattern**: ConexiÃ³n Ãºnica a la base de datos

### Estructura de Carpetas:

```
src/
â”œâ”€â”€ config/           # Configuraciones (DB, env)
â”œâ”€â”€ controllers/      # Controladores HTTP
â”œâ”€â”€ middleware/       # Middlewares (auth, validation)
â”œâ”€â”€ models/          # Interfaces y DTOs
â”œâ”€â”€ repositories/    # Acceso a datos
â”œâ”€â”€ services/        # LÃ³gica de negocio
â”œâ”€â”€ factories/       # Patrones Factory
â”œâ”€â”€ routes/          # DefiniciÃ³n de rutas
â””â”€â”€ app.ts           # AplicaciÃ³n principal
```

## ğŸ” Ejemplos de Uso

### Registrar Usuario

```javascript
POST /api/auth/register
Content-Type: application/json

{
  "username": "trainer_red",
  "email": "red@pokecollector.com",
  "password": "securepass123"
}
```

### Iniciar SesiÃ³n

```javascript
POST /api/auth/login
Content-Type: application/json

{
  "email": "red@pokecollector.com",
  "password": "securepass123"
}

// Respuesta:
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {
      "id": "clx...",
      "username": "trainer_red",
      "email": "red@pokecollector.com",
      "role": "COMMON"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### Agregar Carta a ColecciÃ³n

```javascript
POST /api/cards/collection
Authorization: Bearer [token]
Content-Type: application/json

{
  "cardId": "clx...",
  "quantity": 2
}
```

### Obtener Ranking

```javascript
GET /api/users/ranking

// Respuesta:
{
  "success": true,
  "message": "Ranking retrieved successfully",
  "data": [
    {
      "userId": "clx...",
      "username": "ash_ketchum",
      "totalCards": 5,
      "uniqueCards": 4,
      "completionPercentage": 18,
      "position": 1
    },
    // ...
  ]
}
```

## ğŸ› Troubleshooting

### Error: "Cannot find module '@prisma/client'"
```bash
npm run db:generate
```

### Error: "Database connection failed"
- Verifica que la variable `DATABASE_URL` estÃ© configurada
- Ejecuta `npm run db:push` para crear la base de datos

### Error: "JWT_SECRET not configured"
- AsegÃºrate de tener un `JWT_SECRET` en tu archivo `.env`

## ğŸ“ PrÃ³ximos Pasos

1. **Frontend React**: Crear la interfaz de usuario
2. **Tests**: Implementar pruebas unitarias e integraciÃ³n
3. **Deployment**: Configurar despliegue en Railway/Render
4. **Cache**: Implementar Redis para mejorar performance
5. **ImÃ¡genes**: Sistema de upload de imÃ¡genes de cartas

## ğŸ¤ ContribuciÃ³n

Este es un proyecto acadÃ©mico para demostrar principios SOLID y patrones de diseÃ±o en un sistema real.